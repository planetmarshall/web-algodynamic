---
layout: post
title: An Illustrated Version of The Rime of the Ancient Mariner, for the Amazon Kindle
tags:
- Kindle
status: publish
type: post
published: true
meta:
  _syntaxhighlighter_encoded: '1'
  _wp_old_slug: ''
  dsq_thread_id: '283423794'
---
[singlepic id=145 float=right w=150]<p class="pm_first">A few months ago I jumped on the e-reader bandwagon, and purchased the latest version of Amazon’s Kindle device. By and large I’m extremely pleased with it; reading Douglas Adams' Hitchhiker’s Guide to the Galaxy on a device that bears an uncanny resemblance to the eponymous guide itself ( something I’m <a target="_new" href="http://xkcd.com/548/">not the first</a> to notice ), brings me no end of amusement.</p>
<!--more-->
Nonetheless, many of the commercial e-books available via Amazon’s store leave much to be desired in terms of their suitability for reading on the device, largely down to cheap and/or lazy conversions, making some of the more expensive titles a dubious investment. There is, however, a vast library of free, out of copyright content provided by websites like <a href="http://www.gutenberg.org" target="_new">Project Gutenberg</a>. Being free, it would be churlish to complain about matters of style and formatting, particularly when this is easy to rectify with access to the source and a small amount of technical knowledge. For full details on creating content for the Kindle, see the <a href="http://www.amazon.com/gp/feature.html?ie=UTF8&docId=1000234621" target="_new">Amazon Kindle Publishing Program</a>.

Samuel Taylor Coleridge’s <em><a href="http://www.gutenberg.org/ebooks/151" target="_new">Rime of the Ancient Mariner</a></em> is one of many out of copyright texts provided by Project Gutenberg, in both epub and the Kindle’s native mobipocket format, kindly produced by Judy Boss and David Widger. However, as can be seen in the screenshots below from Amazon’s Kindle Previewer program, the formatting could do with some polish. Additionally, it is unillustrated, which is a shame because <a href="http://en.wikipedia.org/wiki/Gustave_Dor%C3%A9" target="_new">Gustav Dor&eacute;’s</a> wonderful artwork is also available in the public domain, at least in the resolution required for an ebook, from <a href="http://dore.artpassions.net/" target="_new">http://dore.artpassions.net/</a>.

[singlepic id=142 float=left w=150]

Using the plain html file as a starting point, converting it directly results in a file that looks much like the mobi file on Project Gutenberg. However, with access to the source, we can do a bit better.
<h3>Formatting the text for Kindle</h3>
I’m using <a href="http://en.wikipedia.org/wiki/XSLT" target="_new">XSLT</a> 2.0 to create the xhtml source for Amazon’s kindlegen tool. As with the <a target="_new" href="http://www.planetmarshall.co.uk/2010/04/visualizing-the-prime-ministerial-debates/">Prime Ministerial debates project</a>, the input file needs cleaning up before passing it to an XSLT transformation tool such as <a href="http://saxon.sourceforge.net/" target="_new">Saxon</a>.

Following the suggestions here : <a target="_new" href="http://www.xmlplease.com/xhtmlxhtml">http://www.xmlplease.com/xhtmlxhtml</a>, I made the following changes to the input document to prepare it for processing
<ol>
	<li>Added xml header</li>
	<li>Removed HTML DTD. If you don’t do this, most XSLT processors will try to resolve the DTD over the network and take forever as a result.</li>
	<li>Added ENTITY declarations for any named HTML character entities used in the source, such as '&amp;mdash;'</li>
	<li>Removed any invalid xhtml such as orphaned &lt;br&gt; and &lt;hr&gt; tags.</li>
</ol>
Having done that, the document should parse. The snippet below uses XSLT 2.0's regular expression support to add line breaks to the text, and wrap each verse in paragraph blocks. 

[code lang="xml"]
&lt;xsl:template match=&quot;xhtml:pre&quot;&gt;
 &lt;div&gt;
 &lt;xsl:for-each select=&quot;tokenize(string(.),'nn')&quot;&gt;
  &lt;p&gt;&lt;xsl:text&gt;&amp;#10;&lt;/xsl:text&gt;
  &lt;xsl:analyze-string select=&quot;.&quot; regex=&quot;n&quot;&gt;
   &lt;xsl:matching-substring&gt;
    &lt;!-- add newlines to keep the source tidy --&gt;
    &lt;br/&gt;&lt;xsl:text&gt;&amp;#10;&lt;/xsl:text&gt;
   &lt;/xsl:matching-substring&gt;
   &lt;xsl:non-matching-substring&gt;
    &lt;xsl:value-of select=&quot;.&quot;/&gt;
   &lt;/xsl:non-matching-substring&gt;
  &lt;/xsl:analyze-string&gt;
  &lt;xsl:text&gt;&amp;#10;&lt;/xsl:text&gt;&lt;/p&gt;
 &lt;/xsl:for-each&gt;
 &lt;/div&gt;
&lt;/xsl:template&gt; 
[/code]

After adding a stylesheet to centre text and add appropriate paragraph spacing, here is the result.

[singlepic id=144 float=left w=150]

<h3>Licensing and distribution</h3>
I have chosen to license the completed ebook under a Creative Commons <a href="http://creativecommons.org/licenses/by-sa/3.0/" target="_new">share-and-share-alike license</a>, although this does not affect the public domain status of Coleridge's text or Dor&eacute;'s illustrations. The compiled book is available for download from the <a href="http://openlibrary.org/books/OL24489895M/Rime_of_the_ancient_mariner" target="_new">Open Library</a> or directly from the <a href="http://www.archive.org/details/TheRimeOfTheAncientMarinerillustrated" target="_new">Internet Archive</a>. You can also <a href="http://www.planetmarshall.co.uk/files/mariner.zip">download the source</a>, excluding the images.
